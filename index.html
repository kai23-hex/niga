<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Lời Chúc Từ Cyrene</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Quicksand:wght@400;600&subset=vietnamese&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <style>
        /* --- 1. THIẾT LẬP CƠ BẢN --- */
        * { box-sizing: border-box; }
        body {
            margin: 0; padding: 0; height: 100vh;
            background: linear-gradient(135deg, #ffdee9 0%, #b5fffc 100%);
            font-family: 'Quicksand', sans-serif;
            display: flex; justify-content: center; align-items: center;
            overflow: hidden;
            position: relative;
            perspective: 1000px; /* Tạo chiều sâu 3D */
        }

        /* --- 2. HIỆU ỨNG SAO BĂNG --- */
        .sky-container {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 0; pointer-events: none; transform: rotateZ(45deg);
        }
        .shooting_star {
            position: absolute; left: 50%; top: 50%; height: 2px;
            background: linear-gradient(-45deg, #5f91ff, rgba(0, 0, 255, 0));
            border-radius: 999px; filter: drop-shadow(0 0 6px #699bff);
            animation: tail 3000ms ease-in-out infinite, shooting 3000ms ease-in-out infinite;
        }
        .shooting_star::before, .shooting_star::after {
            content: ''; position: absolute; top: calc(50% - 1px); right: 0;
            height: 2px; background: linear-gradient(-45deg, rgba(0, 0, 255, 0), #5f91ff, rgba(0, 0, 255, 0));
            transform: translateX(50%) rotateZ(45deg); border-radius: 100%;
            animation: shining 3000ms ease-in-out infinite;
        }
        .shooting_star::after { transform: translateX(50%) rotateZ(-45deg); }
        @keyframes tail { 0% { width: 0; } 30% { width: 100px; } 100% { width: 0; } }
        @keyframes shooting { 0% { transform: translateX(0); } 100% { transform: translateX(300px); } }
        @keyframes shining { 0% { width: 0; } 50% { width: 30px; } 100% { width: 0; } }
        
        /* Chỉnh vị trí sao băng */
        .shooting_star:nth-child(1) { top: 0; left: 0; animation-delay: 0ms; }
        .shooting_star:nth-child(2) { top: 0; left: 50%; animation-delay: 2000ms; }
        .shooting_star:nth-child(3) { top: 50%; left: 0; animation-delay: 4000ms; }
        .shooting_star:nth-child(4) { top: 50%; left: 50%; animation-delay: 6000ms; }

        /* --- 3. KHUNG THẺ 3D CAO CẤP --- */
        .memory-card {
            background: rgba(255, 255, 255, 0.65);
            backdrop-filter: blur(15px);
            border: 2px solid rgba(255, 255, 255, 0.8);
            padding: 30px;
            border-radius: 30px;
            text-align: center;
            width: 85%; max-width: 420px;
            z-index: 10;
            position: relative;
            transform-style: preserve-3d; /* Giữ các lớp con ở dạng 3D */
            transition: transform 0.1s ease-out; /* Chuyển động mượt mà theo cảm biến */
            overflow: hidden; /* Cắt phần ánh sáng thừa */
            
            /* Hiệu ứng Hào Quang (Breathing Glow) */
            animation: cardGlow 4s infinite alternate;
        }

        /* Luồng sáng quét qua (Shine Effect) */
        .memory-card::before {
            content: ''; position: absolute; top: 0; left: -150%;
            width: 100%; height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.5), transparent);
            transform: skewX(-25deg); pointer-events: none;
            transition: 0s; /* Tắt transition để di chuyển tức thời theo cảm biến */
        }

        @keyframes cardGlow {
            0% { box-shadow: 0 15px 35px rgba(255, 182, 193, 0.3), 0 0 10px rgba(255, 154, 158, 0.1); border-color: rgba(255, 255, 255, 0.8); }
            100% { box-shadow: 0 20px 50px rgba(161, 140, 209, 0.6), 0 0 20px rgba(162, 155, 254, 0.4); border-color: #fff; }
        }

        /* Các phần tử nổi (Parallax) */
        .avatar-frame {
            width: 120px; height: 120px; margin: 0 auto 15px;
            padding: 5px; border-radius: 50%;
            background: linear-gradient(45deg, #ff9a9e, #a18cd1);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transform: translateZ(30px); /* Nổi lên cao */
        }
        .avatar { width: 100%; height: 100%; border-radius: 50%; object-fit: cover; border: 3px solid white; }

        h1 {
            font-family: 'Dancing Script', cursive;
            background: linear-gradient(to right, #e84393, #6c5ce7);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            font-size: 2.2em; margin: 10px 0;
            transform: translateZ(40px);
        }

        p { color: #636e72; font-size: 1.1em; line-height: 1.6; transform: translateZ(25px); }

        /* --- 4. ĐỒNG HỒ ĐẾM NGƯỢC --- */
        .countdown-container { 
            display: flex; justify-content: center; gap: 10px; margin: 20px 0; 
            transform: translateZ(35px); 
        }
        
        .time-bubble {
            background: rgba(255, 255, 255, 0.9);
            width: 60px; height: 70px; 
            border-radius: 15px;
            display: flex; flex-direction: column; 
            justify-content: center; align-items: center;
            box-shadow: 0 5px 15px rgba(162, 155, 254, 0.3);
            border: 1px solid white;
            animation: floatBubble 3s ease-in-out infinite;
        }
        .time-bubble span { font-weight: bold; font-size: 1.5em; color: #6c5ce7; }
        .time-bubble small { font-size: 0.7em; color: #b2bec3; margin-top: 3px; font-weight: bold; }
        
        .time-bubble:nth-child(1) { animation-delay: 0s; }
        .time-bubble:nth-child(2) { animation-delay: 0.5s; }
        .time-bubble:nth-child(3) { animation-delay: 1s; }
        .time-bubble:nth-child(4) { animation-delay: 1.5s; }

        @keyframes floatBubble {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-6px); }
        }

        /* Nút nhận quà */
        .btn-reveal {
            background: linear-gradient(90deg, #ff9a9e, #fad0c4);
            color: white; border: none;
            padding: 12px 30px; border-radius: 50px;
            font-size: 1.1em; font-weight: bold; cursor: pointer;
            box-shadow: 0 5px 15px rgba(255, 154, 158, 0.4);
            transition: transform 0.3s;
            display: none; font-family: 'Quicksand', sans-serif;
            transform: translateZ(50px); /* Nổi cao nhất */
        }
        
        /* Khu vực hiển thị quà */
        #gift-area { display: none; margin-top: 20px; animation: fadeIn 1s; transform: translateZ(30px); }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* --- 5. MÀN HÌNH CHỜ (Overlay) --- */
        /* Dùng để kích hoạt nhạc và quyền cảm biến trên iOS */
        #start-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85); z-index: 999;
            display: flex; justify-content: center; align-items: center; flex-direction: column;
            color: white; transition: opacity 0.5s;
        }
        .start-btn {
            margin-top: 20px; padding: 15px 40px; border-radius: 50px;
            background: #ff9a9e; color: white; border: none; font-size: 1.2em; font-weight: bold;
            animation: pulse 2s infinite; cursor: pointer;
        }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }

    </style>
</head>
<body>

    <div id="start-overlay">
        <h2 style="font-family: 'Dancing Script'; font-size: 2.5em;">Bạn có một món quà!</h2>
        <p>Đeo tai nghe để trải nghiệm tốt nhất 🎧</p>
        <button class="start-btn" onclick="startExperience()">Chạm để mở ✨</button>
    </div>

    <div class="sky-container">
        <div class="shooting_star"></div><div class="shooting_star"></div>
        <div class="shooting_star"></div><div class="shooting_star"></div>
    </div>

    <div class="memory-card" id="card3d">
        <div class="avatar-frame">
            <img src="https://i.postimg.cc/rs4WbSWp/33.jpg" alt="Avatar" class="avatar">
        </div>

        <h1 id="title-text">Chờ Đợi Khoảnh Khắc...</h1>

        <p id="msg-text">
            "Những ký ức đẹp nhất đang được kết tinh.<br>
            Hãy kiên nhẫn thêm một chút nữa nhé, Chị Hậu..."
        </p>

        <div class="countdown-container" id="countdown">
            <div class="time-bubble"><span id="d">00</span><small>Ngày</small></div>
            <div class="time-bubble"><span id="h">00</span><small>Giờ</small></div>
            <div class="time-bubble"><span id="m">00</span><small>Phút</small></div>
            <div class="time-bubble"><span id="s">00</span><small>Giây</small></div>
        </div>

        <button class="btn-reveal" id="btn-gift" onclick="openMemory()">✦ Thu Thập Ký Ức ✦</button>

        <div id="gift-area">
            <p style="color: #6c5ce7; font-weight: bold;">Đã lưu vào Vùng Đất Ký Ức:</p>
            🌸 1x Lời Chúc Vĩnh Cửu<br>
            💎 1x Pha Lê Hạnh Phúc<br>
            <small>(Luôn mỉm cười nhé! ♪)</small>
        </div>
    </div>

    <audio id="bgMusic" loop>
        <source src="nhac.mp3" type="audio/mpeg">
    </audio>

    <script>
    // --- 1. BIẾN CẤU HÌNH ---
    const card = document.querySelector(".memory-card");
    const bgMusic = document.getElementById("bgMusic");
    let isRunning = false;

    // --- 2. XỬ LÝ CẢM BIẾN (GYROSCOPE) ---
    function handleOrientation(event) {
        let x = event.beta;  // Nghiêng trước-sau
        let y = event.gamma; // Nghiêng trái-phải

        // Fix lỗi null trên một số máy Android
        if (x === null || y === null) return;

        // Giới hạn góc nghiêng (Max 30 độ) để không bị lật ngược
        if (x > 30) x = 30; if (x < -30) x = -30;
        if (y > 30) y = 30; if (y < -30) y = -30;

        // Xoay thẻ
        // iPhone và Android đôi khi ngược chiều nhau, đây là chiều chuẩn phổ thông
        card.style.transform = `rotateX(${-x}deg) rotateY(${y}deg)`;
        
        // Di chuyển bóng đổ cho nổi
        let shadowX = -y * 0.5;
        let shadowY = x * 0.5;
        card.style.boxShadow = `${shadowX}px ${shadowY + 15}px 35px rgba(255, 182, 193, 0.4)`;
    }

    // --- 3. XỬ LÝ CẢM ỨNG (TOUCH) - NẾU CẢM BIẾN HỎNG THÌ DÙNG TAY VUỐT ---
    document.addEventListener("touchmove", (e) => {
        if (window.innerWidth > 800) return; // Chỉ chạy trên mobile
        // Lấy vị trí ngón tay
        let touch = e.touches[0];
        let xAxis = (window.innerWidth / 2 - touch.pageX) / 20;
        let yAxis = (window.innerHeight / 2 - touch.pageY) / 20;
        card.style.transform = `rotateY(${xAxis}deg) rotateX(${yAxis}deg)`;
    });

    document.addEventListener("touchend", () => {
        // Thả tay ra thì trả về giữa
        card.style.transform = `rotateY(0deg) rotateX(0deg)`;
    });

    // --- 4. HÀM KHỞI ĐỘNG (XIN QUYỀN IOS + PHÁT NHẠC) ---
    function startExperience() {
        // Ẩn màn hình chờ
        const overlay = document.getElementById('start-overlay');
        if(overlay) {
            overlay.style.opacity = '0';
            setTimeout(() => { overlay.style.display = 'none'; }, 500);
        }

        // Phát nhạc
        if (bgMusic) {
            bgMusic.volume = 0.4;
            bgMusic.play().catch(e => console.log("Lỗi nhạc: ", e));
        }

        // XIN QUYỀN CẢM BIẾN (QUAN TRỌNG NHẤT CHO IPHONE)
        if (typeof DeviceOrientationEvent !== 'undefined' && typeof DeviceOrientationEvent.requestPermission === 'function') {
            // Dành cho iOS 13+
            DeviceOrientationEvent.requestPermission()
                .then(permissionState => {
                    if (permissionState === 'granted') {
                        window.addEventListener('deviceorientation', handleOrientation);
                    } else {
                        alert("Bạn đã từ chối quyền cảm biến. Hãy dùng ngón tay vuốt nhẹ lên thẻ nhé!");
                    }
                })
                .catch(console.error);
        } else {
            // Dành cho Android và iOS đời cũ
            window.addEventListener('deviceorientation', handleOrientation);
        }
    }

    // --- 5. LOGIC ĐỒNG HỒ ĐẾM NGƯỢC (GIỮ NGUYÊN) ---
    const birthdayTime = new Date("December 24, 2025 11:00:00").getTime();

    const timer = setInterval(function() {
        const now = new Date().getTime();
        const distance = birthdayTime - now;

        const d = Math.floor(distance / (1000 * 60 * 60 * 24));
        const h = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        const m = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
        const s = Math.floor((distance % (1000 * 60)) / 1000);

        // Kiểm tra nếu element tồn tại mới gán (tránh lỗi)
        if(document.getElementById("d")) {
            document.getElementById("d").innerText = d < 10 ? "0"+d : d;
            document.getElementById("h").innerText = h < 10 ? "0"+h : h;
            document.getElementById("m").innerText = m < 10 ? "0"+m : m;
            document.getElementById("s").innerText = s < 10 ? "0"+s : s;
        }

        if (distance < 0) {
            clearInterval(timer);
            document.getElementById("countdown").style.display = "none";
            document.getElementById("title-text").innerText = "Chúc Mừng Sinh Nhật!";
            document.getElementById("msg-text").innerHTML = "Thời gian trôi đi như những cánh hoa rơi...<br>Sinh nhật vui vẻ nhé!";
            document.getElementById("btn-gift").style.display = "inline-block";
            
            // Pháo hoa kết thúc
            launchFireworks();
        }
    }, 1000);

    // --- 6. CÁC HÀM PHỤ TRỢ ---
    function launchFireworks() {
        var duration = 15 * 1000;
        var animationEnd = Date.now() + duration;
        var defaults = { startVelocity: 30, spread: 360, ticks: 60, zIndex: 0 };
        function randomInRange(min, max) { return Math.random() * (max - min) + min; }
        var interval = setInterval(function() {
            var timeLeft = animationEnd - Date.now();
            if (timeLeft <= 0) { return clearInterval(interval); }
            var particleCount = 50 * (timeLeft / duration);
            confetti(Object.assign({}, defaults, { particleCount, origin: { x: randomInRange(0.1, 0.3), y: Math.random() - 0.2 } }));
            confetti(Object.assign({}, defaults, { particleCount, origin: { x: randomInRange(0.7, 0.9), y: Math.random() - 0.2 } }));
        }, 250);
    }

    function openMemory() {
        var colors = ['#ff9a9e', '#a18cd1', '#fad0c4'];
        confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 }, colors: colors });
        document.getElementById("gift-area").style.display = "block";
        var btn = document.getElementById("btn-gift");
        btn.innerText = "Đã Lưu Ký Ức ❤️";
        btn.style.pointerEvents = "none";
        btn.style.background = "#b2bec3";
        if(bgMusic) bgMusic.play();
    }

    // --- 7. HIỆU ỨNG MOUSE CHO PC ---
    document.addEventListener("mousemove", (e) => {
        if(window.innerWidth < 800) return;
        let xAxis = (window.innerWidth / 2 - e.pageX) / 25;
        let yAxis = (window.innerHeight / 2 - e.pageY) / 25;
        card.style.transform = `rotateY(${xAxis}deg) rotateX(${yAxis}deg)`;
    });
    
    document.addEventListener("mouseleave", () => {
        if(window.innerWidth > 800) card.style.transform = `rotateY(0deg) rotateX(0deg)`;
    });
</script>
</body>

</html>


